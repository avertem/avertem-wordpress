(this.webpackJsonpsend=this.webpackJsonpsend||[]).push([[0],{171:function(e,t,n){e.exports=n(348)},176:function(e,t,n){},209:function(e,t){},211:function(e,t){},258:function(e,t){},259:function(e,t){},348:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),c=n(25),l=n.n(c),s=(n(5),n(176),n(177),n(178),n(368)),r=n(97),i=n.n(r),u=n(164),m=n(42),d=n(18),h=n(19),f=n(39),p=n(38),g=n(41),E=n(40),v=n(350),_=n(351),b=n(352),j=n(353),w=n(354),O=n(355),C=n(370),y=n(356),A=n(357),k=n(358),S=n(369),T=n(359),N=n(360),x=n(361),D=n(362),P=n(363),q=n(364),M=n(365),V=n(366),H=n(367),W=n(169),J=n(100),B={accountDetails:{account:"",debits:0,credits:0,total:0,progress:0}},F=o.a.createContext({accountDetails:B.accountDetails}),I={transactions:[]},X=o.a.createContext({transactions:I.transactions}),G=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this,e))).toggle=function(e){return function(){var t;console.log("Toggle the modal stuff "+e),n.setState((t={},Object(m.a)(t,"modal_".concat(e),!n.state["modal_".concat(e)]),Object(m.a)(t,"modal_confirm",!0),Object(m.a)(t,"modal_request",!1),Object(m.a)(t,"modal_complete",!1),Object(m.a)(t,"modal_failure",!1),t))}},n.state={balance:0,modal_send:!1,modal_confirm:!0,modal_request:!1,modal_complete:!1,modal_failure:!1,send_info:{amount:0,mnemonic:""},request_info:{},complete_info:{transactionHash:"",transactionValue:0},failure_info:{transactionHash:"",transactionValue:0,error:""},selected:[]},n.handleSendAmountChange=n.handleSendAmountChange.bind(Object(g.a)(n)),n.handleMnemonicChange=n.handleMnemonicChange.bind(Object(g.a)(n)),n.sendTokens=n.sendTokens.bind(Object(g.a)(n)),n}return Object(E.a)(t,e),Object(h.a)(t,[{key:"handleSendAmountChange",value:function(e){var t=this.state.send_info;t.amount=e.target.value,this.setState({send_info:t})}},{key:"handleMnemonicChange",value:function(e){var t=this.state.send_info;t.mnemonic=e.target.value,this.setState({send_info:t})}},{key:"sendTokens",value:function(){var e=Object(u.a)(i.a.mark((function e(t){var n,a=this;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Selected : [%o]",this.state.selected),t.preventDefault(),n=new J.b(new J.a(this.state.send_info.mnemonic),this.state.send_info.amount,this.context.accountDetails.account,this.context.accountDetails.account,this.state.selected[0]),this,this.setState({modal_confirm:!1,modal_request:!0,modal_complete:!1}),fetch("/wp-json/avertem/v1/transaction/send",{method:"POST",body:n.getProtoTransBuffer(),mode:"cors",headers:{"Content-Type":"application/protobuf",session_hash:this.authSession,"Access-Control-Allow-Origin":"*","X-WP-Nonce":window._send_wpnonce},rejectUnauthorized:!1}).then((function(e){console.log("After sending the result is %o",e),200==e.status&&a.setState({modal_confirm:!1,modal_request:!1,modal_complete:!0,complete_info:{transactionHash:n.transactionHashValue.toString("hex"),transactionValue:a.state.send_info.amount}})})).catch((function(e){console.log("Failed to send the transaction %s",e.statusText)}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;this.state.selected;return o.a.createElement(v.a,null,o.a.createElement(_.a,null,o.a.createElement(b.a,null,o.a.createElement(X.Consumer,null,(function(t){var n=[];return console.log("The retrieve transactions [%o]",t),t.transactions.length&&(n=t.transactions.map((function(e){return e.account}))),console.log("Transaction list [%o]",n),o.a.createElement(j.a,null,o.a.createElement(w.a,{for:"sendAccountNumber"},"Target Account Number"),o.a.createElement(W.a,{allowNew:!0,id:"sendAccountNumber",newSelectionPrefix:"Enter new account : ",options:n,placeholder:"Account Number",onChange:function(t){return e.setState({selected:t})}}))})),o.a.createElement(j.a,null,o.a.createElement(w.a,{for:"sendAmount"},"Number(",this.context.accountDetails.total,")"),o.a.createElement(O.a,null,o.a.createElement(C.a,{addonType:"prepend"},"AVT"),o.a.createElement(y.a,{type:"number",name:"sendAmount",id:"sendAmount",placeholder:"0",required:!0,onChange:this.handleSendAmountChange,value:this.state.send_info.amount})))),o.a.createElement(A.a,null,o.a.createElement(k.a,{color:"primary",onClick:this.toggle("send")},"Send"),o.a.createElement(S.a,{isOpen:this.state.modal_send,toggle:this.toggle("send"),className:this.props.className},o.a.createElement(T.a,{toggle:this.toggle("send")},"Confirm Send ",this.state.send_info.value),this.state.modal_confirm&&o.a.createElement(N.a,null,o.a.createElement(j.a,null,o.a.createElement(w.a,{for:"mnemonic"},"Mnemonic Phrase"),o.a.createElement(y.a,{type:"textarea",name:"mnemonic",value:this.state.send_info.mnemonic,onChange:this.handleMnemonicChange,required:!0},"Mnemonic Phrase"),o.a.createElement(x.a,{color:"muted"},"Please provide your mnemonic phrase for confirmation."))),this.state.modal_complete&&o.a.createElement(N.a,null,o.a.createElement(D.a,null,o.a.createElement(P.a,null,o.a.createElement(q.a,null,"Transaction"),o.a.createElement(M.a,null,this.state.complete_info.transactionHash)),o.a.createElement(P.a,null,o.a.createElement(q.a,null,"Amount"),o.a.createElement(M.a,null,this.state.complete_info.transactionValue)))),this.state.modal_failure&&o.a.createElement(N.a,null,o.a.createElement(D.a,null,o.a.createElement(P.a,null,o.a.createElement(q.a,null,"Transaction"),o.a.createElement(M.a,null,this.state.failure_info.transactionHash)),o.a.createElement(P.a,null,o.a.createElement(q.a,null,"Amount"),o.a.createElement(M.a,null,this.state.failure_info.transactionValue)),o.a.createElement(P.a,null,o.a.createElement(q.a,null,"Error"),o.a.createElement(M.a,null,this.state.failure_info.transactionValue)))),o.a.createElement(V.a,null,this.state.modal_confirm&&o.a.createElement("div",null,o.a.createElement(k.a,{color:"primary",onClick:this.sendTokens},"Send")," ",o.a.createElement(k.a,{color:"secondary",onClick:this.toggle("send")},"Cancel")),this.state.modal_request&&o.a.createElement("div",null,o.a.createElement(N.a,null,o.a.createElement(H.a,{color:"dark"}))),this.state.modal_complete&&this.state.modal_failure&&o.a.createElement("div",null,o.a.createElement(k.a,{color:"secondary",onClick:this.toggle("send")},"Close")))))))}}]),t}(a.Component);G.contextType=F;var z=G,U=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this,e))).state={accountDetails:B.accountDetails},n}return Object(E.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.getAccount()}},{key:"getAccount",value:function(){var e=this;fetch("/wp-json/avertem/v1/account/info",{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Origin":"*","X-WP-Nonce":window._send_wpnonce}}).then((function(e){if(200==e.status)return e.json();console.log("Failed to process request [%o]",e)})).then((function(t){if(t){console.log("error [%o]",t);var n=JSON.parse(t);console.log(n),e.setState({accountDetails:{account:n.account,debits:n.data.debits,credits:n.data.credits,total:n.data.total,progress:parseInt(n.data.debits)/parseInt(n.data.credits)*100}})}})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){return o.a.createElement(F.Provider,{value:this.state},this.props.children)}}]),t}(o.a.Component),$=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(f.a)(this,Object(p.a)(t).call(this,e))).authSession=e.authSession,n.state={transactions:I.transactions},n}return Object(E.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.getTransactions()}},{key:"getTransactions",value:function(){var e=this;fetch("/wp-json/avertem/v1/account/transactions",{method:"GET",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json","Access-Control-Allow-Origin":"*","X-WP-Nonce":window._send_wpnonce}}).then((function(e){if(200==e.status)return e.json();console.log("Failed to process request [%o]",e)})).then((function(t){if(t){console.log("error [%o]",t);var n=JSON.parse(t);console.log(n),e.setState({transactions:n.data?n.data:[]})}})).catch((function(e){console.log(e)}))}},{key:"render",value:function(){return o.a.createElement(X.Provider,{value:this.state},this.props.children)}}]),t}(o.a.Component);var K=function(){return o.a.createElement(U,null,o.a.createElement($,null,o.a.createElement(s.a,null,o.a.createElement(z,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(K,null),document.getElementById("avertem_send_id")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[171,1,2]]]);
//# sourceMappingURL=main.5ca14340.chunk.js.map